<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="CameraDAO">
    <select id="getAvailableCameraList" resultMap="getAvailableCameraList">
        SELECT TR.totalOfRecord, CameraId, CameraName
        FROM tblCamera,
             (SELECT COUNT(CameraId) AS totalOfRecord
             FROM tblCamera
             WHERE StatusId = 3 AND TypeDetect = #{typeDetect}) TR
        WHERE StatusId = 3 AND TypeDetect = #{typeDetect}
        ORDER BY CameraName ASC
    </select>
    <select id="getCameraList">
        SELECT C.CameraId,
               C.CameraName,
               C.ImageURL,
               C.IPAddress,
               C.TypeDetect,
               ST.StoreId,
               C.UpdatedTime,
               C.StatusId,
               STT.StatusName
        FROM tblCamera C
        JOIN tblStatus STT ON C.StatusId = STT.StatusId
        LEFT JOIN tblStackProductCameraMapping SPCM ON SPCM.CameraId = C.CameraId AND SPCM.StatusId = 1
        LEFT JOIN tblStack STK ON SPCM.StackId = STK.StackId AND STK.StatusId = 1
        LEFT JOIN tblShelf SH ON STK.ShelfId = SH.ShelfId AND SH.StatusId != 2
        LEFT JOIN tblStore ST ON SH.StoreId = ST.StoreId AND ST.StatusId != 2
        WHERE ST.StoreId = #{storeId}
    </select>
    <resultMap id="getAvailableCameraList" type="ResponseAvailableCameraListForm">
        <result property="totalOfRecord" column="totalOfRecord"/>
        <collection property="cameras" ofType="AvailableCameraListResponseSupporter">
            <id property="cameraId" column="CameraId"/>
            <id property="cameraName" column="CameraName"/>
        </collection>
    </resultMap>
</mapper>